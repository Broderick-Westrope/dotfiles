#!/bin/bash

{{- if .system.is_macos }}

set -euo pipefail

echo "ğŸ“¦ Installing packages..."

# Ensure Homebrew is in PATH
if [[ -f "/opt/homebrew/bin/brew" ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f "/usr/local/bin/brew" ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
fi

# Update Homebrew
echo "ğŸ”„ Updating Homebrew..."
brew update

# Install formulae
echo "ğŸ”§ Installing Homebrew formulae..."
brew install \
{{- range .brew.formulae }}
    {{ . | quote }} \
{{- end }}

# Install casks
echo "ğŸ“± Installing Homebrew casks..."
brew install --cask \
{{- range .brew.casks }}
    {{ . | quote }} \
{{- end }}

# Clean up
echo "ğŸ§¹ Cleaning up..."
brew cleanup

echo "âœ… Package installation complete"

{{- else }}

echo "âŒ This script only supports macOS"
exit 1

{{- end }}